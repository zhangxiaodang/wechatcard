<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.allinpay.wechatcard.dao.CommonDao">

	<!-- 取得Appid和AppSecret -->
	<select id="getAppInfo" parameterType="java.util.Map" resultType="java.util.Map">
		select appid,appsecret
		from merchant
		where urlflag = #{urlFlag}
	</select>
	
	<select id="getRegister" parameterType="java.util.Map" resultType="int">
		select count(1) as cnt
		from member t1, merchant t2
		where
		     t1.memberopenid = #{openid}
		 and t2.urlflag = #{urlflag}
		 and t1.merchantid = t2.merchantid
	</select>
	
	<!-- 根据openID获取会员的id -->
	<select id="getMemberIDByOpenID" parameterType="String" resultType="java.util.Map">
		SELECT MEMBERID,B.ITEMVALUE AS MEMBERGRADE, MERCHANTID, MEMBERPHONE FROM MEMBER A
		LEFT JOIN SELECTOPTIONS B ON A.MEMBERGRADE = B.ITEMCODE AND B.ITEMTPYE = '1003'
		WHERE MEMBEROPENID = #{openid}
	</select>
	
	<!-- 根据urlFlag获取商户信息 -->
	<select id="getMerchantInfoByUrlFlag" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT MERCHANTID FROM MERCHANT
		WHERE URLFLAG = #{urlflag}
	</select>
</mapper>
	